{
  "version": 3,
  "sources": ["../../../../../apps/customized_item_search/customized_item_search/public/js/frappe/form/link_selector.js"],
  "sourcesContent": ["\n// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.LinkSelector = class LinkSelector {\n\tconstructor(opts) {\n\t\t/* help: Options: doctype, get_query, target */\n\t\t$.extend(this, opts);\n\n\t\tvar me = this;\n\t\tif (this.doctype != \"[Select]\") {\n\t\t\tfrappe.model.with_doctype(this.doctype, function (r) {\n\t\t\t\tme.make();\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make();\n\t\t}\n\t}\n\tmake() {\n\t\tvar me = this;\n\n\t\tthis.start = 0;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select {0}\", [this.doctype == \"[Select]\" ? __(\"value\") : __(this.doctype)]),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tfieldname: \"txt\",\n\t\t\t\t\tlabel: __(\"Beginning with\"),\n\t\t\t\t\tdescription: __(\"You can use wildcard %\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: \"results\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tfieldname: \"more\",\n\t\t\t\t\tlabel: __(\"More\"),\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tme.start += 20;\n\t\t\t\t\t\tme.search();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Search\"),\n\t\t\tprimary_action: function () {\n\t\t\t\tme.start = 0;\n\t\t\t\tme.search();\n\t\t\t},\n\t\t});\n\n\t\tif (this.txt) this.dialog.fields_dict.txt.set_input(this.txt);\n\n\t\tthis.dialog.get_input(\"txt\").on(\"keypress\", function (e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\tme.start = 0;\n\t\t\t\tme.search();\n\t\t\t}\n\t\t});\n\t\tthis.dialog.show();\n\t\tthis.search();\n\t}\n\tsearch() {\n\t\tvar args = {\n\t\t\ttxt: this.dialog.fields_dict.txt.get_value(),\n\t\t\tsearchfield: \"name\",\n\t\t\tstart: this.start,\n\t\t};\n\t\tvar me = this;\n\n\t\tif (this.target.set_custom_query) {\n\t\t\tthis.target.set_custom_query(args);\n\t\t}\n\n\t\t// load custom query from grid\n\t\tif (\n\t\t\tthis.target.is_grid &&\n\t\t\tthis.target.fieldinfo[this.fieldname] &&\n\t\t\tthis.target.fieldinfo[this.fieldname].get_query\n\t\t) {\n\t\t\t$.extend(args, this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc));\n\t\t}\n\n\t\tfrappe.link_search(\n\t\t\tthis.doctype,\n\t\t\targs,\n\t\t\tfunction (r) {\n\t\t\t\tvar parent = me.dialog.fields_dict.results.$wrapper;\n\t\t\t\tif (args.start === 0) {\n\t\t\t\t\tparent.empty();\n\t\t\t\t}\n\n\t\t\t\tif (r.values.length) {\n\t\t\t\t\t$.each(r.values, function (i, v) {\n\t\t\t\t\t\tvar row = $(\n\t\t\t\t\t\t\trepl(\n\t\t\t\t\t\t\t\t'<div class=\"row link-select-row\">\\\n\t\t\t\t\t\t<div class=\"col-xs-4\">\\\n\t\t\t\t\t\t\t<b><a href=\"#\">%(name)s</a></b></div>\\\n\t\t\t\t\t\t<div class=\"col-xs-8\">\\\n\t\t\t\t\t\t\t<span class=\"text-muted\">%(values)s</span></div>\\\n\t\t\t\t\t\t</div>',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: v[0],\n\t\t\t\t\t\t\t\t\tvalues: v.splice(1).join(\", \"),\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t).appendTo(parent);\n\n\t\t\t\t\t\trow.find(\"a\")\n\t\t\t\t\t\t\t.attr(\"data-value\", v[0])\n\t\t\t\t\t\t\t.click(function () {\n\t\t\t\t\t\t\t\tvar value = $(this).attr(\"data-value\");\n\t\t\t\t\t\t\t\tif (me.target.is_grid) {\n\t\t\t\t\t\t\t\t\t// set in grid\n\t\t\t\t\t\t\t\t\t// call search after value is set to get latest filtered results\n\t\t\t\t\t\t\t\t\tme.set_in_grid(value).then(() => me.search());\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (me.target.doctype)\n\t\t\t\t\t\t\t\t\t\tme.target.parse_validate_and_set_in_model(value);\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tme.target.set_input(value);\n\t\t\t\t\t\t\t\t\t\tme.target.$input.trigger(\"change\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t$(\n\t\t\t\t\t\t'<p><br><span class=\"text-muted\">' +\n\t\t\t\t\t\t\t__(\"No Results\") +\n\t\t\t\t\t\t\t\"</span>\" +\n\t\t\t\t\t\t\t(frappe.model.can_create(me.doctype)\n\t\t\t\t\t\t\t\t? '<br><br><a class=\"new-doc btn btn-default btn-sm\">' +\n\t\t\t\t\t\t\t\t  __(\"Create a new {0}\", [__(me.doctype)]) +\n\t\t\t\t\t\t\t\t  \"</a>\"\n\t\t\t\t\t\t\t\t: \"\") +\n\t\t\t\t\t\t\t\"</p>\"\n\t\t\t\t\t)\n\t\t\t\t\t\t.appendTo(parent)\n\t\t\t\t\t\t.find(\".new-doc\")\n\t\t\t\t\t\t.click(function () {\n\t\t\t\t\t\t\tfrappe.new_doc(me.doctype);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (r.values.length < 20) {\n\t\t\t\t\tvar more_btn = me.dialog.fields_dict.more.$wrapper;\n\t\t\t\t\tmore_btn.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis.dialog.get_primary_btn()\n\t\t);\n\t}\n\tset_in_grid(value) {\n        \n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.qty_fieldname) {\n                let updated = (this.target.frm.doc[this.target.df.fieldname] || []).some(\n                    (d) => {\n                        if (d[this.fieldname] === value) {\n                            frappe.model\n                                .set_value(d.doctype, d.name, this.qty_fieldname, data.qty)\n                                .then(() => {\n                                    frappe.show_alert(\n                                        __(\"Added {0} ({1})\", [\n                                            value,\n                                            d[this.qty_fieldname],\n                                        ])\n                                    );\n                                    resolve();\n                                });\n                            return true;\n                        }\n                    }\n                );\n                if (!updated) {\n                    let d = null;\n                    frappe.run_serially([\n                        () => (d = this.target.add_new_row()),\n                        () => frappe.timeout(0.1),\n                        () => {\n                            let args = {};\n                            args[this.fieldname] = value;\n                            args[this.qty_fieldname] = 1;\n                            return frappe.model.set_value(d.doctype, d.name, args);\n                        },\n                        () => frappe.show_alert(__(\"Added {0} ({1})\", [value, 1])),\n                        () => resolve(),\n                    ]);\n                }\n\t\t\t} else if (this.dynamic_link_field) {\n\t\t\t\tlet d = this.target.add_new_row();\n\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\td.doctype,\n\t\t\t\t\td.name,\n\t\t\t\t\tthis.dynamic_link_field,\n\t\t\t\t\tthis.dynamic_link_reference\n\t\t\t\t);\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, this.fieldname, value).then(() => {\n\t\t\t\t\tfrappe.show_alert(__(\"{0} {1} added\", [this.dynamic_link_reference, value]));\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet d = this.target.add_new_row();\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, this.fieldname, value).then(() => {\n\t\t\t\t\tfrappe.show_alert(__(\"{0} added\", [value]));\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n};\n\nfrappe.link_search = function (doctype, args, callback, btn) {\n\tif (!args) {\n\t\targs = {\n\t\t\ttxt: \"\",\n\t\t};\n\t}\n\targs.doctype = doctype;\n\tif (!args.searchfield) {\n\t\targs.searchfield = \"name\";\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.search.search_widget\",\n\t\ttype: \"GET\",\n\t\targs: args,\n\t\tcallback: function (r) {\n\t\t\tcallback && callback(r);\n\t\t},\n\t\tbtn: btn,\n\t});\n};\n"],
  "mappings": "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",
  "names": []
}
